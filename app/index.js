// Generated by CoffeeScript 1.3.3
var app, assets, express, getMS, http, port, stylus;

express = require('express');

stylus = require('stylus');

assets = require('connect-assets');

http = require('http');

app = express();

app.use(assets());

app.set('view engine', 'jade');

app.get('/', function(req, res) {
  var output;
  output = getMS('phishvids.com');
  return res.render('index');
});

app.get('/site/:site', function(req, res) {
  return getMS(req.params.site, function(output) {
    return res.json(output);
  });
});

getMS = function(site, callback) {
  var start,
    _this = this;
  start = new Date();
  return http.get({
    host: site,
    port: 80
  }, function(res) {
    var length;
    length = new Date() - start;
    return callback({
      message: "Request took: " + length + ("ms (" + site + ")"),
      time: length,
      site: site,
      status: res.statusCode
    });
  });
};

port = process.env.PORT || process.env.VMC_APP_PORT || 8000;

app.listen(port, function() {
  return console.log("Listening on " + port);
});
